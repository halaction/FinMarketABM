# Модель финансового рынка FinMarketABM

## I. Сеттинг

Предположим полную информацию в игре. 

#### *Общие информационные переменные*

- Длительность игры `periods_number`
- Периодичность ходов инвесторов (по умолчанию = 1) `investors_period`
- Периодичность пополнения доходов инвестора `investors_income_period`
- Периодичность ходов компаний `companies_period`
- Число инвесторов, компаний и торгуемых финансовых инструментов
- Ожидаемая и действительная чистая прибыль всех компаний
- Цены и количество (объем) всех торгуемых активов 
- Ставки дисконтирования (стоимость капитала) всех компаний
- Стоимость всех компаний
- Общерыночная ставка процента по депозиту `deposit_rate`

## II. Агенты модели

### 1. Инвестор

#### *Состояние*

Состояние инвестора задается 4 переменными:

- Идентификатор компании `id`
- Чистый внешний доход инвестора `income` (поток). Обновляется в периоды, кратные
`investors_income_period`. Предполагается постоянным. Доход, не потраченный 
в настоящем периоде `t` прибавляется к стоимости портфеля в периоде `t+1` 
по депозитной ставке `deposit_rate`
- Стоимость портфеля `assets_value`. Включает накопленный внешний доход и
рыночную стоимость финансовых инструментов во владении инвестора.
- Свободные средства `cash`. Средства, доступные в данный момент для 
покупки активов
- Портфель инвестора `instruments`. Это список, содержащий число финансовых
инструментов, которые принадлежат инвестору, длины, равной числу торгуемых на
рынке инструментов `instruments_number`.
- Ставка дисконтирования инвестора `delta`. 

Состояния инвестора в первом периоде инициируются в `settings` списками с 
префиксами `investors_<...>`

#### *Поведение*

В начале каждого периода инвесторы принимают вычисляют ожидаемую доходность каждого
торгуемого на рынке финансового инструмента согласно функции оценки ожидаемой 
цены финансового инструмента в следующем периоде `investors_expectation`. 
Она инициируется в `settings` и не зависит от периода. 
Аргументами функции ожиданий являются траектории информационных
переменных `companies_income_actual`, `companies_income_expected` и 
случайная составляющая - ошибка прогноза.
Также в функции ожиданий учитывается 
альтернативная стоимость капитала - возможность внесения дохода инвестора 
под депозитную ставку `deposit_rate`.

Таким образом, инвесторы определяют ожидаемую цену актива исходя из
фундаментального анализа. В обобщении модели возможна модификация функции 
ожидаемой цены, включающей текущую цену актива на рынке, т.е. 
добавление элементов технического анализа.

На основе значения функции ожидаемой цены (ожидаемых доходностей инструментов
`instruments_yield`)
инвестор принимает решение о покупке / продаже актива:

Для периода `t` находится актив с минимальной взвешенной доходностью ниже 1 и максимальной 
взвешенной доходностью выше 1. Сравнивается стоимость портфеля `assets_value` инвестора 
в случае продажи убыточного актива и в случае покупки прибыльного актива 
(эти события не могут произойти одновременно) в периоде `t`. 
Цена заявки определяется следующим образом (доходность = `yield` < 1, 
текущая рыночная цена актива = `price`):

- Цена продажи: случайная величина на интервале (`price` * `yield`, inf)
с матожиданием = `price`
- Объем продажи: весь объем убыточного актива

- Цена покупки: случайная величина на интервале (`price`/0, `price` * `yield`) 
с матожиданием = `price`
- Объем покупки: инвестор выкупает актив на все доступные средства, 
если инвестор изменит оценку доходности.

- Опция снятия заявки - TBD

Итак, инвестор принимает решение о выставлении заявки о покупке / продаже 
или о снятии существующей заявки сравнивая условную ожидаемую стоимость портфеля,
т.е. ожидаемую стоимости портфеля при условии выбора 1 из 3 альтернатив и 
невыбора 2 из 3 остальных альтернатив.

После того, как все инвесторы приняли решения, они отправляют заявки на биржу, 
эти заявки поступают в базу данных заявок `order_log` в случайном порядке внутри 
текущего периода . Таким образом, предполагается, что инвесторы не могут 
повлиять на скорость подачи заявки. 

Далее в текущий биржевой стакан `order_book` после стандартного механизма мэтчинга
заявок из `order_log` добавляется информация о текущей цене (цена последней
исполненной заявки по инструменту) и активных заявках. 
Конец периода

#### *Предпочтения*

Инвестор максимизирует `assets_value` в последнем периоде (?).

### 2. Публичные компании

#### *Состояние*

Состояние компании задается 4 переменными:

- Идентификатор компании `id`
- Действительная чистая прибыль в прошлом периоде `income_actual`. Задается
детерминированная траектория или случайный процесс.
- Ожидаемый чистая прибыль в настоящем периоде `income_expected`. Ожидаемый 
доход - это абстрактная оценка, информация о которой в базовой
версии модели доступна всем участникам рынка. 
- Ставка дисконтирования компании `delta`.
- Стоимость компании `value`. Рассчитывается как перпетуитет ожидаемого
дохода компании `value = income_expected / delta`.

Предполагается, что это первый период выхода компании 
на рынок => book value = market value в t = 1 и состояния инициируются 
из `settings`. 

#### *Поведение*

В начале каждого периода `t`, кратного переменной `companies_period`, компании
объявляют действительную чистую прибыль за прошлый период `t-1` и ожидаемую 
чистую прибыль в период `t`.

Расчет оценки ожидаемой прибыли - это задача подпрограммы (инкапсуляция), возможен вариант константного прогноза, 
случайного блуждания либо модели машинного обучения. В базовой модели компания не может
повлиять на свою прибыль, однако можно по мере развития модели добавить
модель инвестиций (в капитал, в улучшение качества прогноза).

#### *Предпочтения*

В базовой модели предпочтения отсутствуют, так как компания не может влиять на 
величину генерируемой чистой прибыли, траектория случайна. 

В общем случае, в модели с инвестициями компания максимизирует 
свою приведенную стоимость `value`

### 3. Финансовые инструменты

Объекты, могут быть реализованы все инструменты, но в базовой версии
рассмотрим только акции.

#### *Состояние* = *Информационные переменные*

- Идентификатор инструмента `id`
- Тип инструмента `type`. По умолчанию `share` - акции
- Идентификатор компании-эмитента `issuer_id`
- Цена инструмента `price`
- Суммарный объем данной ценной бумаги `total_quantity`
- Специальные параметры ценной бумаги `params`. Для облигаций - это 
размер купона. Для акций - дивидендная норма. Заметим, что в текущем описании
нет механизма дивидендов, это состояние еще в проекте.

### 4. Возможные дополнительные агенты

- Банковский сектор - представляет собой альтернативу финансовых инструментов, предлагая private debt.
- Экономика в целом - как генератор шоков и информационных переменных
